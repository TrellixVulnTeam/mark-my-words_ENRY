@using MudBlazor 
@using Pages

@inject IDialogService Dialog;
@inject NavigationManager NavMan;

<MudNavMenu Class="mudblazor-navmenu">
    <AuthorizeView>
        <Authorized>
            <MudButton StartIcon="@Icons.Material.Filled.Add"
                       IconColor="Color.Secondary"
                       Variant="Variant.Filled"
                       Color="Color.Primary"
                       OnClick="NewAssignment">
                New Assignment
            </MudButton>
            @foreach (string assignmentId in assignmentsIds)
            {
                <MudNavLink Href="@($"/attempts/{assignmentId}")">@assignmentId.Substring(0, 7)</MudNavLink>
            }
        </Authorized>
        <NotAuthorized>

        </NotAuthorized>
    </AuthorizeView>
</MudNavMenu>

@code {
    public List<string> assignmentsIds { get; set; } = new List<string>();

    protected async override Task OnInitializedAsync()
    {
        Console.WriteLine(NavMan.BaseUri);
        await RefreshAssignmentsList();
    }

    private async Task NewAssignment()
    {
        DialogOptions options = new DialogOptions()
        {
            MaxWidth = MaxWidth.Large
        };
        IDialogReference dialog = Dialog.Show<CreateNewAssignmentDialog>("Create Assignment", options);
        DialogResult result = await dialog.Result;

        if (!result.Cancelled)
        {
            AssignmentModel assignmentModel = (AssignmentModel)result.Data;
            await ServerCommunicator.AssignmentToServer(NavMan.BaseUri, assignmentModel);
        }

        await RefreshAssignmentsList();
    }

    private async Task RefreshAssignmentsList()
    {
        assignmentsIds = await ServerCommunicator.AssignmentListFromServer(NavMan.BaseUri);
    }
}
