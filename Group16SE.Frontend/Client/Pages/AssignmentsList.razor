@page "/assignments"

@attribute [Authorize]

@inject IDialogService Dialog

<MudTable Items="assignmentsIds" Hover="true">
    <HeaderContent>
        <MudTh>ID</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="ID">@context</MudTd>
    </RowTemplate>
</MudTable>

<MudIconButton Icon="@Icons.Material.Filled.Add"
               Color="Color.Primary"
               OnClick="NewAssignment">

</MudIconButton>

@code {

    public List<string> assignmentsIds { get; set; } = new List<string>();

    protected async override Task OnInitializedAsync()
    {
        await RefreshAssignmentsList();
    }

    private async Task NewAssignment()
    {
        DialogOptions options = new DialogOptions()
        {
            MaxWidth = MaxWidth.Large
        };
        IDialogReference dialog = Dialog.Show<CreateNewAssignmentDialog>("Create Assignment", options);
        DialogResult result = await dialog.Result;

        if (!result.Cancelled)
        {
            AssignmentModel assignmentModel = (AssignmentModel)result.Data;
            await ServerCommunicator.AssignmentToServer(assignmentModel);
        }

        await RefreshAssignmentsList();
    }

    private async Task RefreshAssignmentsList()
    {
        assignmentsIds = await ServerCommunicator.AssignmentListFromServer();
    }
}
